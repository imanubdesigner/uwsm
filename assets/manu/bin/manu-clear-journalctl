#!/usr/bin/env bash

#    ┏┓┓        ┏┳┏┓┳┳┳┓┳┓┏┓┓ ┏┓┏┳┓┓   ┓
#    ┃ ┃┏┓┏┓┏┓   ┃┃┃┃┃┣┫┃┃┣┫┃ ┃  ┃ ┃   ┃ ┏┓┏┓
#    ┗┛┗┗ ┗┻┛   ┗┛┗┛┗┛┛┗┛┗┛┗┗┛┗┛ ┻ ┗┛  ┗┛┗┛┗┫
#                                    ┛

#!/usr/bin/env bash

set -euo pipefail

# ─────────────────────────────────────────────
# Fancy header (only if gum is installed)
# ─────────────────────────────────────────────
if command -v gum >/dev/null; then
  gum style \
    --border double \
    --border-foreground "#89B4FA" \
    --foreground "#CDD6F4" \
    --padding "1 3" \
    --margin "1 0" \
    --align center \
    "󰃢  Log Maintenance — Ultimate Edition" \
    "" \
    "Cleaning system and user journals safely"
fi

echo "󰑓  Rotating journals..."
sudo journalctl --rotate

echo "󰃢  Vacuuming archived journals..."
sudo journalctl --vacuum-time=1s
sudo journalctl --user --vacuum-time=1s

# ─────────────────────────────────────────────
# HARD CLEAN: remove persistent journals on disk
# ─────────────────────────────────────────────
if [ -d /var/log/journal ]; then
  echo "󰋊  Removing persistent journals..."

  sudo systemctl stop systemd-journald
  sudo rm -rf /var/log/journal/*
  sudo systemctl start systemd-journald
fi

# ─────────────────────────────────────────────
# Clean runtime journals (current boot)
# ─────────────────────────────────────────────
if [ -d /run/log/journal ]; then
  echo "󰉁  Cleaning runtime journals..."

  sudo rm -rf /run/log/journal/*
  sudo systemctl restart systemd-journald
fi

# ─────────────────────────────────────────────
# Clean temporary directories
# ─────────────────────────────────────────────
echo "󰩺  Cleaning temporary files..."

sudo rm -rf /tmp/*
sudo rm -rf /var/tmp/*

# ─────────────────────────────────────────────
# Desktop notification (if available)
# ─────────────────────────────────────────────
if command -v notify-send >/dev/null; then
  notify-send "󰍹  System Maintenance" "Logs and temp files cleaned successfully."
fi
