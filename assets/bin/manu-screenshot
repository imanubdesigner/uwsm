#!/usr/bin/env bash

#    ┏┓┏┓┳┓┏┓┏┓┳┓┏┓┓┏┏┓┏┳┓  ┏┓┏┓┳┓┳┏┓┏┳┓
#    ┗┓┃ ┣┫┣ ┣ ┃┃┗┓┣┫┃┃ ┃   ┗┓┃ ┣┫┃┃┃ ┃
#    ┗┛┗┛┛┗┗┛┗┛┛┗┗┛┛┗┗┛ ┻   ┗┛┗┛┛┗┻┣┛ ┻
#                                by Manu

# ┌──────────────────────────────┐
# │          FLAGS               │
# ├──────────┬───────────────────┤
# │   r c    │ region → clipboard│
# │   r f    │ region → file     │
# │   r i    │ region → i(satty) │
# │   s c    │ screen → clipboard│
# │   s f    │ screen → file     │
# │   s i    │ screen → i(satty) │
# │   p      │ pick color        │
# └──────────┴───────────────────┘

OUTPUT_DIR="${HOME}/Pictures/Screenshots"
mkdir -p "$OUTPUT_DIR"

# ────────────────────────────────────────────────
# Region → Clipboard
# ────────────────────────────────────────────────
if [[ $1 == rc ]]; then
  region=$(slurp -b '#000000b0' -c '#00000000') || exit 0
  [[ -z "$region" ]] && exit 0

  grim -g "$region" - | wl-copy
  notify-send "󰄄  Screenshot" "󰅍  Region copied to clipboard"

# ────────────────────────────────────────────────
# Region → File
# ────────────────────────────────────────────────
elif [[ $1 == rf ]]; then
  region=$(slurp -b '#000000b0' -c '#00000000') || exit 0
  [[ -z "$region" ]] && exit 0

  filename="$OUTPUT_DIR/$(date +%Y-%m-%d_%H-%M-%S).png"
  grim -g "$region" "$filename" &&
    notify-send "󰄄  Screenshot" "󰆓  Saved to $filename"

# ────────────────────────────────────────────────
# Region → Interactive (Satty)
# ────────────────────────────────────────────────
elif [[ $1 == ri ]]; then
  region=$(slurp -b '#000000b0' -c '#00000000') || exit 0
  [[ -z "$region" ]] && exit 0

  out="$OUTPUT_DIR/screenshot-$(date +'%Y-%m-%d_%H-%M-%S').png"

  grim -g "$region" - | satty --filename - \
    --output-filename "$out" \
    --early-exit \
    --actions-on-enter save-to-clipboard \
    --save-after-copy \
    --copy-command 'wl-copy'

  # notify only if the file was actually created (not canceled)
  [[ -f "$out" ]] && notify-send "󰄄  Screenshot" "󰙀  Region edited & copied"

# ────────────────────────────────────────────────
# Screen → Clipboard
# ────────────────────────────────────────────────
elif [[ $1 == sc ]]; then
  grim - | wl-copy &&
    notify-send "󰄄  Screenshot" "󰅍  Screen copied to clipboard"

# ────────────────────────────────────────────────
# Screen → File
# ────────────────────────────────────────────────
elif [[ $1 == sf ]]; then
  filename="$OUTPUT_DIR/$(date +%Y-%m-%d_%H-%M-%S).png"
  grim "$filename" &&
    notify-send "󰄄  Screenshot" "󰆓  Saved to $filename"

# ────────────────────────────────────────────────
# Screen → Interactive (Satty)
# ────────────────────────────────────────────────
elif [[ $1 == si ]]; then
  out="$OUTPUT_DIR/screenshot-$(date +'%Y-%m-%d_%H-%M-%S').png"

  grim - | satty --filename - \
    --output-filename "$out" \
    --early-exit \
    --actions-on-enter save-to-clipboard \
    --save-after-copy \
    --copy-command 'wl-copy'

  [[ -f "$out" ]] && notify-send "󰄄  Screenshot" "󰙀  Screen edited & copied"

# ────────────────────────────────────────────────
# Color Picker
# ────────────────────────────────────────────────
elif [[ $1 == p ]]; then
  color=$(hyprpicker -a)
  if [[ $? -eq 0 && -n $color ]]; then
    wl-copy "$color"
    notify-send "󰏘  Color Picker" "󰅍  Copied $color to clipboard"
  fi
fi
